<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>03 - Run transition risk stress test on corporate loan books • r2dii.climate.stress.test</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="03 - Run transition risk stress test on corporate loan books">
<meta property="og:description" content="r2dii.climate.stress.test">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r2dii.climate.stress.test</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-setup-project-directories.html">01 - Set up project directories for climate transition risk stress test</a>
    </li>
    <li>
      <a href="../articles/02-prepare-loans-inputs.html">02 - Prepare loan input files for stress testing corporate loan books</a>
    </li>
    <li>
      <a href="../articles/03-run-stress-test.html">03 - Run transition risk stress test on corporate loan books</a>
    </li>
    <li>
      <a href="../articles/04-read-the-outputs.html">04 - Understand the output files of the transition risk stress test</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="03-run-stress-test_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>03 - Run transition risk stress test on corporate loan books</h1>
            
      
      
      <div class="hidden name"><code>03-run-stress-test.Rmd</code></div>

    </div>

    
    
<p>This vignette describes in detail, how to run a climate transition risk stress test for loans, using the function <code>run_stress_test</code> to calculate the credit risk of a loan book.</p>
<div class="section level2">
<h2 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a>
</h2>
<p>In order to keep this vignette concise, we assume the following has been set up:</p>
<ol style="list-style-type: decimal">
<li>R and RStudio are installed.</li>
<li>All required R packages are installed, specifically. <code>r2dii.climate.stress.test</code>. Note that this may require installing additional packages. You will be prompted to install these in case any are missing.</li>
<li>The user has obtained all relevant input files as described in the pdf manual.</li>
<li>The user has successfully run at least the matching part of PACTA for Banks to produce the relevant project-specific raw input files.</li>
<li>The input files are organized in a folder structure consistent with the one described in the vignette <a href="https://2degreesinvesting.github.io/r2dii.climate.stress.test/articles/articles/01-setup-project-directories.html">“Set up project directories”</a>.</li>
<li>The user has successfully run the function <code><a href="../reference/run_prep_calculation_loans.html">run_prep_calculation_loans()</a></code> to generate the intermediate input files for the main stress test function in the required format. Refer to the <a href="https://2degreesinvesting.github.io/r2dii.climate.stress.test/articles/articles/02-prepare-loans-inputs.html">corresponding vignette</a> for details on how to do this.</li>
</ol>
</div>
<div class="section level2">
<h2 id="running-the-analysis">Running the Analysis<a class="anchor" aria-label="anchor" href="#running-the-analysis"></a>
</h2>
<p>The climate transition risk stress test can be run for a single set of parameters with one value per input argument or as a sensitivity analysis, where one of the input arguments is iterated over and gets a vector of parameters and all other arguments get one input value each. We will look at both cases.</p>
<p>Use <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> to attach the package</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://2degreesinvesting.github.io/r2dii.climate.stress.test">r2dii.climate.stress.test</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-the-stress-test-for-one-scenario">Running the Stress Test for one scenario<a class="anchor" aria-label="anchor" href="#running-the-stress-test-for-one-scenario"></a>
</h2>
<p>In order to run a stress test for loans on one set of parameters, the user needs to pass exactly one value per input argument to the function <code><a href="../reference/run_stress_test.html">run_stress_test()</a></code>. The only arguments that do not have a default value and must be set by the user are <code>asset_type</code> and the file paths. In this case, we want to run the stress test for loans, so the easiest way to obtain results is by running:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/run_stress_test.html">run_stress_test</a></span><span class="op">(</span>
  asset_type <span class="op">=</span> <span class="st">"loans"</span>,
  input_path_project_specific <span class="op">=</span> <span class="st">"/path/to/specific/data/inputs"</span>,
  input_path_project_agnostic <span class="op">=</span> <span class="st">"/path/to/agnostic/data"</span>,
  output_path <span class="op">=</span> <span class="st">"/path/to/output/directory"</span>
<span class="op">)</span></code></pre></div>
<p>This will calculate the stress test for loans and write the results along with a log file into the designated output directory, using the default values for all detail arguments.</p>
<p><strong>NOTE:</strong> The default mode will <strong>not return</strong> any objects within the R session. We find this is the easiest and most user friendly way to obtain results. We alternatively provide the option that the function returns a list holding the result objects. This allows the user to inspect and further analyze the data directly in R.</p>
<div class="section level3">
<h3 id="input-arguments">Input arguments<a class="anchor" aria-label="anchor" href="#input-arguments"></a>
</h3>
<p>Specifications on the detail arguments are summarized in the following overview. The defaults that are used if the argument is not adjusted when calling <code><a href="../reference/run_stress_test.html">run_stress_test()</a></code> can be found in column <code>default</code>. The user may change any detail argument by explicitly passing it to the function. Note that there are allowed values for each of the inputs. For logical or character variables refer to column <code>allowed</code>, for numeric variables the allowed values are the range from <code>min</code> (inclusive) to <code>max</code> (inclusive).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stress_test_arguments</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 6</span></span>
<span class="co">#&gt;    name                    type      default allowed              min   max  </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> asset_type              character <span style="color: #BB0000;">NA</span>      equity, bonds, loans <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> lgd_senior_claims       double    0.45    <span style="color: #BB0000;">NA</span>                   0.3   0.6  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> lgd_subordinated_claims double    0.75    <span style="color: #BB0000;">NA</span>                   0.6   0.9  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> risk_free_rate          double    0.02    <span style="color: #BB0000;">NA</span>                   0     0.05 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> discount_rate           double    0.07    <span style="color: #BB0000;">NA</span>                   -0.01 0.1  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> div_netprofit_prop_coef double    1       <span style="color: #BB0000;">NA</span>                   0.8   1    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> shock_year              double    2030    <span style="color: #BB0000;">NA</span>                   2025  2035 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> term                    double    2       <span style="color: #BB0000;">NA</span>                   1     5    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> company_exclusion       logical   TRUE    TRUE, FALSE          <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> use_company_terms       logical   FALSE   TRUE, FALSE          <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="understanding-the-input-arguments">Understanding the input arguments<a class="anchor" aria-label="anchor" href="#understanding-the-input-arguments"></a>
</h3>
<p>The meaning of each of the detail arguments is as follows:</p>
<ul>
<li>
<code>lgd_senior_claims</code> is the loss given default used in the expected loss calculation of loans for senior claims (notably for corporate loans, so this is a potentially important parameter in this calculation)</li>
<li>
<code>lgd_subordinated_claims</code> is the loss given default used in the expected loss calculation of loans for subordinated claims (notably for corporate bonds. Not of relevance in the loans calculation)</li>
<li>
<code>risk_free_rate</code> the risk free interest rate. Input parameter to the Merton credit risk model.</li>
<li>
<code>discount_rate</code> the annual rate at which future cash flows are discounted when calculating the net present value of companies in the loan book. Since the net present values are indirect inputs into the Merton credit risk model, this parameter my be relevant.</li>
<li>
<code>div_netprofit_prop_coef</code> Coefficient that indicates what share of the net present value should be considered to derive the equity value of a company.</li>
<li>
<code>shock_year</code> year in which the policy is introduced, that adjusts the production values of companies to stay in line with carbon budgets.</li>
<li>
<code>term</code> indicates which maturity the loans in the loan book are assumed to have. At this point we assume these are rolled over every year.</li>
<li>
<code>company_exclusion</code> Logical parameter that indicates if certain combinations of company and technology should be excluded from the analysis. At this point, it is strictly recommended to set this to TRUE (default) because there is not yet a dedicated mechanism in place that handles companies which are phasing out certain technologies within the time frame of the production forecast.</li>
<li>
<code>use_company_terms</code> Logical parameter, indicating if individually provided terms for companies as configured in company_terms.csv shall be used instead of fallback as provided in <code>term</code>.</li>
<li>
<code>return_results</code> Logical parameter that indicates if the outputs of the analysis should be directly written to the indicated output path or simply returned as a list of results within the running session. The default is FALSE, which writes the outputs to the target directory and does not return them as a list object in R.</li>
</ul>
</div>
<div class="section level3">
<h3 id="adjusting-the-input-arguments">Adjusting the input arguments<a class="anchor" aria-label="anchor" href="#adjusting-the-input-arguments"></a>
</h3>
<p>The user may want to run a stress test that is tailored to their assumptions about a plausible transition risk shock scenario. For example, the user could decide to set a lower <code>risk_free_rate</code> and shock the companies earlier than by default, using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/run_stress_test.html">run_stress_test</a></span><span class="op">(</span>
  asset_type <span class="op">=</span> <span class="st">"loans"</span>,
  input_path_project_specific <span class="op">=</span> <span class="st">"/path/to/specific/data/inputs"</span>,
  input_path_project_agnostic <span class="op">=</span> <span class="st">"/path/to/agnostic/data"</span>,
  output_path <span class="op">=</span> <span class="st">"/path/to/output/directory"</span>,
  risk_free_rate <span class="op">=</span> <span class="fl">0.01</span>,
  shock_year <span class="op">=</span> <span class="fl">2028</span>
<span class="op">)</span></code></pre></div>
<p><strong>NOTE:</strong> One important input argument that affects the behavior of where the results are written, is the argument <code>return_results</code>. Per default it is set to <code>FALSE</code>, which means that results are written as csv files to a sub directory in the <code>output_path</code> and the user must open these files to view the results. If the user wants to view the results directly in R, they can set the argument to <code>TRUE</code> which will return them as a list of data frames in the R session. This means they are not written to the designated <code>output_path</code> however, so the user must do this by themselves if the results ought to be kept. In this case, the user must still provide an output path though, as every calculation will write a log file.</p>
</div>
<div class="section level3">
<h3 id="output-files">Output files<a class="anchor" aria-label="anchor" href="#output-files"></a>
</h3>
<p>The output files are written into a sub directory of the path indicated as <code>output_path</code> in the function call. The name of the sub directory is created from the time stamp of the analysis and a suffix. The suffix <code>_standard</code> is used when each argument uses a single parameter value. If a sensitivity analysis (see below) is run the name of the varied detail variable is used. The sub directory will be generated automatically, this way we ensure that no existing results are overwritten.</p>
<ul>
<li><code>log_file_standard.txt</code></li>
<li><code>stress_test_results_loans_port_standard.csv</code></li>
<li><code>stress_test_results_loans_comp_standard.csv</code></li>
<li><code>stress_test_results_loans_comp_el_standard.csv</code></li>
<li><code>stress_test_results_loans_sector_pd_changes_annual_standard.csv</code></li>
<li><code>stress_test_results_loans_sector_pd_changes_overall_standard.csv</code></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="running-a-sensitivity-analysis-for-the-stress-test">Running a Sensitivity Analysis for the Stress Test<a class="anchor" aria-label="anchor" href="#running-a-sensitivity-analysis-for-the-stress-test"></a>
</h2>
<p>In case the user wants to understand the sensitivities of the model to the input parameters mentioned above, it is straight forward to run a sensitivity analysis that does exactly that.</p>
<p>In order to do that, one simply passes a vector of allowed values for one (and only one) of the detail arguments when running the stress test function. This will lead to the model iterating over the set of values passed for the chosen argument, while keeping all other input arguments constant.</p>
<p><strong>NOTE:</strong> It is not possible to iterate over <code>asset_type</code> and <code>term</code>.</p>
<p>If the user wishes to understand the impact of the <code>shock_year</code> on the results for example, they can run the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/run_stress_test.html">run_stress_test</a></span><span class="op">(</span>
  asset_type <span class="op">=</span> <span class="st">"loans"</span>,
  input_path_project_specific <span class="op">=</span> <span class="st">"/path/to/specific/data/inputs"</span>,
  input_path_project_agnostic <span class="op">=</span> <span class="st">"/path/to/agnostic/data"</span>,
  output_path <span class="op">=</span> <span class="st">"/path/to/output/directory"</span>,
  shock_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2025</span>, <span class="fl">2028</span>, <span class="fl">2032</span>, <span class="fl">2035</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>This will yield outputs with four versions of the stress test, one for each of the shock years indicated. All the results will be written into one file per output type for ease of use, e.g.:</p>
<ul>
<li><code>stress_test_results_loans_port_shock_year.csv</code></li>
<li><code>stress_test_results_loans_comp_shock_year.csv</code></li>
<li><code>stress_test_results_loans_comp_el_shock_year.csv</code></li>
<li><code>stress_test_results_loans_sector_pd_changes_annual_shock_year.csv</code></li>
<li><code>stress_test_results_loans_sector_pd_changes_overall_shock_year.csv</code></li>
</ul>
<p><strong>NOTE:</strong> The suffix of the files is now changed to mirror which variable was iterated over. This enables the user to run multiple different sensitivity analyses for a project and easily navigate these.</p>
<p>When running a sensitivity analysis one one input, the user can still use other values than the default parameters for the other input arguments.</p>
<p>For example, when iterating over the <code>shock_year</code>, it is still possible to use a <code>risk_free_rate</code> lower than the default like so:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/run_stress_test.html">run_stress_test</a></span><span class="op">(</span>
  asset_type <span class="op">=</span> <span class="st">"loans"</span>,
  input_path_project_specific <span class="op">=</span> <span class="st">"/path/to/specific/data/inputs"</span>,
  input_path_project_agnostic <span class="op">=</span> <span class="st">"/path/to/agnostic/data"</span>,
  output_path <span class="op">=</span> <span class="st">"/path/to/output/directory"</span>,
  risk_free_rate <span class="op">=</span> <span class="fl">0.01</span>,
  shock_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2025</span>, <span class="fl">2028</span>, <span class="fl">2032</span>, <span class="fl">2035</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><strong>NOTE</strong> that the selected detail arguments will be written to the result files so that it is always possible to understand which parameters were used in any given calculation.</p>
</div>
<div class="section level2">
<h2 id="interpretation-of-the-output-files">Interpretation of the output files<a class="anchor" aria-label="anchor" href="#interpretation-of-the-output-files"></a>
</h2>
<p>Detailed explanations of the result files can be found in the vignette: <a href="https://2degreesinvesting.github.io/r2dii.climate.stress.test/articles/articles/04-read-the-outputs.html">“Understand the output files of the transition risk stress test”</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jacob Kastl, 2 Degrees Investing Initiative.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
