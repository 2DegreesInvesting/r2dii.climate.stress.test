<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>02 - Prepare loan input files for stress testing corporate loan books • r2dii.climate.stress.test</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="02 - Prepare loan input files for stress testing corporate loan books">
<meta property="og:description" content="r2dii.climate.stress.test">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r2dii.climate.stress.test</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-prerequisites.html">00 - Prerequisites</a>
    </li>
    <li>
      <a href="../articles/01-setup-project-directories.html">01 - Set up project directories for climate transition risk stress test</a>
    </li>
    <li>
      <a href="../articles/02-prepare-loans-inputs.html">02 - Prepare loan input files for stress testing corporate loan books</a>
    </li>
    <li>
      <a href="../articles/03-run-stress-test.html">03 - Run transition risk stress test on corporate loan books</a>
    </li>
    <li>
      <a href="../articles/04-advanced-data-settings.html">04 - Improve stress test by providing further project specific data</a>
    </li>
    <li>
      <a href="../articles/05-read-the-outputs.html">05 - Understand the output files of the transition risk stress test</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="02-prepare-loans-inputs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>02 - Prepare loan input files for stress testing corporate loan books</h1>
            
      
      
      <div class="hidden name"><code>02-prepare-loans-inputs.Rmd</code></div>

    </div>

    
    
<p>This vignette describes in detail, how to prepare the intermediate input files needed to run the climate transition risk stress test for a corporate loan book.</p>
<div class="section level2">
<h2 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a>
</h2>
<p>In order to keep this vignette concise, we assume the following has been done:</p>
<ol style="list-style-type: decimal">
<li>R and RStudio are installed.</li>
<li>All required R packages are installed, specifically. <code>r2dii.climate.stress.test</code>. Note that this may require installing additional packages. You will be prompted to install these in case any are missing.</li>
<li>The user has obtained all relevant input files as described in the pdf manual.</li>
<li>The user has successfully run at least the matching part of PACTA for Banks to produce the relevant project-specific raw input files.</li>
<li>The input files are organized in a folder structure consistent with the one described in the vignette <a href="https://2degreesinvesting.github.io/r2dii.climate.stress.test/articles/articles/01-setup-project-directories.html">“Set up project directories”</a>.</li>
</ol>
</div>
<div class="section level2">
<h2 id="running-the-loan-book-preparation">Running the Loan Book Preparation<a class="anchor" aria-label="anchor" href="#running-the-loan-book-preparation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://2degreesinvesting.github.io/r2dii.climate.stress.test">r2dii.climate.stress.test</a></span><span class="op">)</span></code></pre></div>
<p>The raw and matched loan book files need to be run through PACTA for banks and wrangled into the specific input format required by <code>r2dii.climate.stress.test</code>. To make this process as easy as possible for the user, we provide a function, <code><a href="../reference/run_prep_calculation_loans.html">run_prep_calculation_loans()</a></code>, which takes care of all relevant steps with minimal input from the user.</p>
<p><strong>NOTE:</strong> We strongly recommend providing the matched and prioritized loan book in one file for the entire raw loan book to be analyzed. In PACTA for banks, it can sometimes be advantageous for matching to split the loan book into separate files for each sector (or other splits). This should be avoided here, since the function also calculates relative exposures. Hence, after completing the steps of matching and prioritizing the loan book, all prioritized files should be combined into one file, before running this function.</p>
<p>Supported sectors are:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sectors_lookup</span>
<span class="co">#&gt; [1] "Power"      "Oil&amp;Gas"    "Coal"       "Automotive"</span></code></pre></div>
<p>Beside the file paths, the only argument that can be set is <code>credit_type</code>, which defaults to <code>"outstanding"</code> if the user passes no argument.</p>
<p>View other options by running:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">credit_type_lookup</span>
<span class="co">#&gt; [1] "outstanding"  "credit_limit"</span></code></pre></div>
<p>If everything has been set up correctly, simply running the following command in R will read the raw and matched loan books from the indicated project-specific inputs directory and auxiliary data from the project-agnostic data directory.</p>
<p>It will then perform all calculations and wrangling required and write the intermediate input files <code>Loans_results_company.rda</code> and <code>overview_portfolio.rda</code> to the indicated <code>data_prep_output_path</code>. <strong>NOTE:</strong> Data generated with this workflow will serve as inputs for the subsequent stress test. Thus it is advisable to set <code>data_prep_output_path</code> to the same path as <code>input_path_project_specific</code> so that the generated data is written there.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/run_prep_calculation_loans.html">run_prep_calculation_loans</a></span><span class="op">(</span>
  input_path_project_specific <span class="op">=</span> <span class="st">"/path/to/specific/data/inputs"</span>,
  input_path_project_agnostic <span class="op">=</span> <span class="st">"/path/to/agnostic/data"</span>,
  data_prep_output_path <span class="op">=</span> <span class="st">"/path/to/specific/data/inputs"</span>
<span class="op">)</span></code></pre></div>
<p>Since the argument credit_type has a default value, it is not required to set it, in case the user wants to run the stress test on the outstanding credit values in the loan book.</p>
<p>However, it is also possible to run the analysis on the credit limits of the loans, in case these have been provided in the raw and matched loan books. To achieve this, instead of the previous command, simply run:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/run_prep_calculation_loans.html">run_prep_calculation_loans</a></span><span class="op">(</span>
  input_path_project_specific <span class="op">=</span> <span class="st">"/path/to/specific/data/inputs"</span>,
  input_path_project_agnostic <span class="op">=</span> <span class="st">"/path/to/agnostic/data"</span>,
  data_prep_output_path <span class="op">=</span> <span class="st">"/path/to/specific/data/inputs"</span>,
  credit_type <span class="op">=</span> <span class="st">"credit_limit"</span>
<span class="op">)</span></code></pre></div>
<p>Regardless of which case is chosen, the intermediate input files are generated in the correct format so that the user can directly continue with the main calculation of the stress test, as described in vignette <a href="https://2degreesinvesting.github.io/r2dii.climate.stress.test/articles/articles/03-run-stress-test.html">“Run stress test”</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jacob Kastl, 2 Degrees Investing Initiative.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
